"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4432],{13546:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>n,metadata:()=>l,toc:()=>c});var t=s(62540),r=s(43023);const n={description:"This topic discusses quality gates and review rules from an administrator perspective. It also discusses some of the known issues with the project level `rules.pl` file and how to work around them.",id:"qualitygates",keywords:["quality gates","review rules"],lastUpdatedAt:"May 6, 2020",product:"teamforge",tags:["project admin_tasks","project_member_tasks","source_code","git_gerrit","scm"],title:"Quality Gates and Review Rules"},o=void 0,l={id:"qualitygates",title:"Quality Gates and Review Rules",description:"This topic discusses quality gates and review rules from an administrator perspective. It also discusses some of the known issues with the project level `rules.pl` file and how to work around them.",source:"@site/versioned_docs/version-23.1/qualitygates.md",sourceDirName:".",slug:"/qualitygates",permalink:"/docs/qualitygates",draft:!1,unlisted:!1,tags:[{inline:!0,label:"project admin_tasks",permalink:"/docs/tags/project-admin-tasks"},{inline:!0,label:"project_member_tasks",permalink:"/docs/tags/project-member-tasks"},{inline:!0,label:"source_code",permalink:"/docs/tags/source-code"},{inline:!0,label:"git_gerrit",permalink:"/docs/tags/git-gerrit"},{inline:!0,label:"scm",permalink:"/docs/tags/scm"}],version:"23.1",lastUpdatedAt:1721042912e3,frontMatter:{description:"This topic discusses quality gates and review rules from an administrator perspective. It also discusses some of the known issues with the project level `rules.pl` file and how to work around them.",id:"qualitygates",keywords:["quality gates","review rules"],lastUpdatedAt:"May 6, 2020",product:"teamforge",tags:["project admin_tasks","project_member_tasks","source_code","git_gerrit","scm"],title:"Quality Gates and Review Rules"},sidebar:"docs",previous:{title:"Mass Configuration of Repository Policies",permalink:"/docs/mass-repo-policy-settings"},next:{title:"UserFilter Removal",permalink:"/docs/userfilterremoval"}},a={},c=[{value:"Quality Gates in TeamForge",id:"quality-gates-in-teamforge",level:2},{value:"Review Rules in TeamForge",id:"review-rules-in-teamforge",level:2},{value:"The Difference Between Review Rules and Quality Gates",id:"the-difference-between-review-rules-and-quality-gates",level:2},{value:"Working with Project Review Rules",id:"working-with-project-review-rules",level:2},{value:"Quality Gates Location Change from TeamForge 20.0",id:"quality-gates-location-change-from-teamforge-200",level:2}];function d(e){const i={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h2,{id:"quality-gates-in-teamforge",children:"Quality Gates in TeamForge"}),"\n",(0,t.jsxs)(i.p,{children:["TeamForge Quality Gates are CollabNet specific xml files that define the conditions to be met before a commit can be merged into master (when code is ready to be pushed for production). Those xml files are stored in the ",(0,t.jsx)(i.code,{children:"TF-Project/refs/meta/config/quality_gates"})," directory. TeamForge provides four predefined quality gates:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"ci_and_human_approval_required.xml"}),"\n",(0,t.jsx)(i.li,{children:"no_approval_required.xml"}),"\n",(0,t.jsx)(i.li,{children:"ci_approval_required.xml"}),"\n",(0,t.jsx)(i.li,{children:"human_review_required.xml"}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Here is an example of a predefined quality gate xml file: ",(0,t.jsx)(i.code,{children:"ci_approval_required.xml"})]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r\n<cn:GerritWorkflow xmlns:cn="http://www.collab.net/gerritworkflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" description="CI has to approve, +1 Verified allows to merge, -1 vetoes it." enableCodeReview="true" enableVerification="true" name="ci_approval_required" version="1" xsi:schemaLocation="http://www.collab.net/gerritworkflow gerritworkflow.xsd">\r\n   <cn:SubmitRule actionIfSatisfied="allow" displayName="Verified-To-Merge">\r\n      <cn:VotingCondition value="1" votingCategory="Verified"/>\r\n   </cn:SubmitRule>\r\n   <cn:SubmitRule actionIfSatisfied="block" displayName="Verified-Veto-Blocks-Merge">\r\n      <cn:VotingCondition value="-1" votingCategory="Verified"/>\r\n   </cn:SubmitRule>\r\n</cn:GerritWorkflow>\n'})}),"\n",(0,t.jsx)(i.p,{children:"These xml files are the building blocks for Review Rules."}),"\n",(0,t.jsx)(i.h2,{id:"review-rules-in-teamforge",children:"Review Rules in TeamForge"}),"\n",(0,t.jsx)(i.p,{children:"The following image shows the list of review rules that are available in TeamForge (the repository settings page)."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:s(21060).A+"",width:"1430",height:"687"})}),"\n",(0,t.jsxs)(i.p,{children:["The list of review rules can contain not only quality gates-based rules from ",(0,t.jsx)(i.code,{children:"TF-Projects"}),", but also some repository specific policies. In other words, Review Rules can, but do not necessarily have to be defined using the quality gates. You can think of Quality Gates as a TeamForge-specific extension to Review Rules."]}),"\n",(0,t.jsxs)(i.p,{children:["In the above image, in addition to the four pre-defined rules based on quality gates, you can see two more global rules\u2014",(0,t.jsx)(i.code,{children:"Global Rule 1"})," and ",(0,t.jsx)(i.code,{children:"Global Rule 2"}),". Those are Review Rules that are based on custom quality gates, which are stored in the same place as the pre-defined quality gates\u2014at ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," of ",(0,t.jsx)(i.code,{children:"TF-Projects"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["The last rule\u2014",(0,t.jsx)(i.code,{children:"Custom"}),"\u2014only applies to the given repository, and is defined in the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file of ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch of the current repository. It is visible only to this repository. That means, unlike the other Review Rules, it will not be shown in the ",(0,t.jsx)(i.strong,{children:"Review Rules"})," drop-down list of any other repository on this server."]}),"\n",(0,t.jsx)(i.h2,{id:"the-difference-between-review-rules-and-quality-gates",children:"The Difference Between Review Rules and Quality Gates"}),"\n",(0,t.jsxs)(i.p,{children:["Review Rules are stored in the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file of ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch in a given repository and represent the application of the given Quality Gates to this specific repository."]}),"\n",(0,t.jsxs)(i.p,{children:["You can adjust it by modifying the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file and pushing it again to the ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch of this repository."]}),"\n",(0,t.jsxs)(i.p,{children:["In a nutshell, the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file is generated from the Quality Gates and it looks like this:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-shell",children:"submit_rule(Z):-cn:workflow(\u2018<XML of a given Quality Gates>\u2019, Z).\n"})}),"\n",(0,t.jsx)(i.p,{children:"It simply wraps Quality Gates into a prolog element."}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"rules.pl"})," file content is supposed to be a prolog program, which is used by Gerrit to determine the review rules. So, Gerrit expects prolog there. However, to simplify the review rules definition, CollabNet has introduced a building block called ",(0,t.jsx)(i.code,{children:"cn:workflow"})," that takes the quality gates xml definition as an input, and generates a review rule out of it\u2014so that customers are not required to implement their own review rules in prolog  any longer."]}),"\n",(0,t.jsxs)(i.p,{children:["When you select a review rule from the TeamForge UI, a new ",(0,t.jsx)(i.code,{children:"rules.pl"})," file is generated that is based on the selected quality gates. This file will be verified for correctness and then pushed to the ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch of the repository. At this moment, it becomes the actual review rules policy that is enforced by Gerrit on this repository."]}),"\n",(0,t.jsxs)(i.p,{children:["An example ",(0,t.jsx)(i.code,{children:"rules.pl"})," file:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-shell",children:'submit_rule(Z):-cn:workflow(\'<?xml version="1.0" encoding="UTF-8" standalone="no"?><cn:GerritWorkflow xmlns:cn="http://www.collab.net/gerritworkflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" description="Merging is possible without any further approval." enableCodeReview="true" enableVerification="false" name="collabnet" version="1" xsi:schemaLocation="http://www.collab.net/gerritworkflow gerritworkflow.xsd"> <cn:SubmitRule actionIfSatisfied="allow" displayName="Merge-Always-Enabled"/> </cn:GerritWorkflow>\', Z).\n'})}),"\n",(0,t.jsxs)(i.p,{children:["However, it is still possible to use a custom prolog ",(0,t.jsx)(i.code,{children:"rule.pl"})," file if you want to. Such a file, does not have to be based on the quality gates xml. No need to use the ",(0,t.jsx)(i.code,{children:"cn:workflow"})," element."]}),"\n",(0,t.jsx)(i.p,{children:"Here's an example for custom Gerrit prolog rule."}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-shell",children:"submit_rule(submit(CR, V)) :-    CR = label('Code-Review', ok(user(ID))),    V = label('Verified', ok(user(ID))).\n"})}),"\n",(0,t.jsx)(i.p,{children:"Here's an example for custom xml based prolog rule."}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-shell",children:'submit_rule(Z):-cn:workflow(\'<?xml version="1.0" encoding="UTF-8" standalone="no"?><cn:GerritWorkflow xmlns:cn="http://www.collab.net/gerritworkflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" description="Merging is possible without any further approval." enableCodeReview="true" enableVerification="false" name="jenkins" version="1" xsi:schemaLocation="http://www.collab.net/gerritworkflow gerritworkflow.xsd"> <cn:SubmitRule actionIfSatisfied="allow" displayName="Merge-Always-Enabled"/> </cn:GerritWorkflow>\', Z).\n'})}),"\n",(0,t.jsx)(i.h2,{id:"working-with-project-review-rules",children:"Working with Project Review Rules"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"rules.pl"})," can be based on one of the predefined quality gates in ",(0,t.jsx)(i.code,{children:"TF-Projects"})," ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," or can be totally new (Custom)."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsxs)(i.strong,{children:["Modifying the ",(0,t.jsx)(i.code,{children:"rules.pl"})," File"]})}),"\n",(0,t.jsxs)(i.p,{children:["Repository specific submit rules are stored in the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file at ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch of the project. You must fetch and checkout the ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch."]}),"\n",(0,t.jsxs)(i.p,{children:["To create or edit the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file:"]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["Fetch: ",(0,t.jsx)(i.code,{children:"$ git fetch origin refs/meta/config:config"})]}),"\n",(0,t.jsxs)(i.li,{children:["Checkout: ",(0,t.jsx)(i.code,{children:"$ git checkout config"})]}),"\n",(0,t.jsxs)(i.li,{children:["Edit or create the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file."]}),"\n",(0,t.jsxs)(i.li,{children:["Git add: ",(0,t.jsx)(i.code,{children:"$ git add rules.pl"})]}),"\n",(0,t.jsxs)(i.li,{children:["Commit: ",(0,t.jsx)(i.code,{children:'$ git commit -m "My submit rules"'})]}),"\n",(0,t.jsxs)(i.li,{children:["Push: ",(0,t.jsx)(i.code,{children:"$ git push origin HEAD:refs/meta/config"})]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Here's a list of example screenshots with information and error messages that could possibly show up when you use a custom ",(0,t.jsx)(i.code,{children:"rules.pl"})," file."]}),"\n",(0,t.jsxs)(i.p,{children:["Example-1\r\n: The following message appears when the review rule selected is valid and is not based on one of the predefined quality gates.\r\n: ",(0,t.jsx)(i.img,{src:s(34623).A+"",width:"1670",height:"772"})]}),"\n",(0,t.jsxs)(i.p,{children:["Example-2\r\n: A warning message when the review rule has an empty name attribute.\r\n: ",(0,t.jsx)(i.img,{src:s(72886).A+"",width:"1670",height:"788"})]}),"\n",(0,t.jsxs)(i.p,{children:["Example-3\r\n: An error message that shows up when the current review rule has no name.\r\n: ",(0,t.jsx)(i.img,{src:s(47145).A+"",width:"1670",height:"788"}),"\r\n: To fix this, check out the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file and provide a name and push it back to ",(0,t.jsx)(i.code,{children:"refs/mets/config"}),"."]}),"\n",(0,t.jsxs)(i.p,{children:["Example-4\r\n: A warning message that shows up when the ",(0,t.jsx)(i.code,{children:"rules.pl"})," file of a specific repository has the same name as one of the predefined quality gates, but the submit rules are different. Such a ",(0,t.jsx)(i.code,{children:"rule.pl"})," is still valid, but it is a good practice to have unique names.\r\n: ",(0,t.jsx)(i.img,{src:s(75968).A+"",width:"1428",height:"504"})]}),"\n",(0,t.jsxs)(i.p,{children:["Example-5\r\n: An error message when you use [UserFilter][userfilterremoval] (removed from Gerrit) in your ",(0,t.jsx)(i.code,{children:"rule.pl"})," file.\r\n: ",(0,t.jsx)(i.img,{src:s(31003).A+"",width:"1428",height:"626"}),"\r\n: To fix this, check out the ",(0,t.jsx)(i.code,{children:"rule.pl"})," file, remove the ",(0,t.jsx)(i.code,{children:"UserFilter"})," and push it back to the ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch of the project repository."]}),"\n",(0,t.jsx)(i.h2,{id:"quality-gates-location-change-from-teamforge-200",children:"Quality Gates Location Change from TeamForge 20.0"}),"\n",(0,t.jsxs)(i.p,{children:["The quality gates xml files were stored at ",(0,t.jsx)(i.code,{children:"/opt/collabnet/gerrit/etc/quality_gates"})," directory in TeamForge 19.0 and earlier."]}),"\n",(0,t.jsxs)(i.p,{children:["However, with TeamForge 20.0 and later, the quality gates xml files have been moved to the ",(0,t.jsx)(i.code,{children:"refs/meta/config"})," branch of the ",(0,t.jsx)(i.code,{children:"TF-Projects"})," repository in Gerrit. This makes it simple as TeamForge administrators no longer need file system level access to the Gerrit server to add or remove rules."]}),"\n",(0,t.jsx)(i.admonition,{type:"note",children:(0,t.jsx)(i.p,{children:"You cannot modify or delete predefined quality gates. However, you can add new ones."})}),"\n",(0,t.jsxs)(i.p,{children:["Here's a ",(0,t.jsx)(i.a,{href:"https://resources.collab.net/blogs/you-shall-not-pass-control-your-code-quality-gates-with-a-wizard-part-i",children:"blog post"})," for further reference."]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},21060:(e,i,s)=>{s.d(i,{A:()=>t});const t=s.p+"assets/images/201-qualitygates-01-14f070f6ca507159ad0709d7b25c048d.png"},34623:(e,i,s)=>{s.d(i,{A:()=>t});const t=s.p+"assets/images/201-qualitygates-02-58fd08cc9541d746311dbdb9e34067e0.png"},72886:(e,i,s)=>{s.d(i,{A:()=>t});const t=s.p+"assets/images/201-qualitygates-03-230f6d509a10408b63ce1983cd8b39bb.png"},47145:(e,i,s)=>{s.d(i,{A:()=>t});const t=s.p+"assets/images/201-qualitygates-04-f29fad0fb754cde9c82754383114bd0b.png"},75968:(e,i,s)=>{s.d(i,{A:()=>t});const t=s.p+"assets/images/201-qualitygates-05-cdca7e3bed28ace55d15aacd8ee4daa5.png"},31003:(e,i,s)=>{s.d(i,{A:()=>t});const t=s.p+"assets/images/201-qualitygates-06-168fc67be1b171fc4d09a7ea608e6bcc.png"},43023:(e,i,s)=>{s.d(i,{R:()=>o,x:()=>l});var t=s(63696);const r={},n=t.createContext(r);function o(e){const i=t.useContext(n);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(n.Provider,{value:i},e.children)}}}]);